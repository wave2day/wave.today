<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Past Events</title>

  <style>
    html,body{
      margin:0;
      padding:0;
      background:#07070c;
      color:#eef0ff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }
    a,button{ -webkit-tap-highlight-color: transparent; }
    a:focus, a:focus-visible, button:focus, button:focus-visible{ outline: none !important; box-shadow:none !important; }


    /* ===== Ambient background (bez videa) ===== */
    
    #ambientPoster{
      position:fixed;
      inset:-8vmax;
      z-index:-3;
      background-size: cover;
      background-position: center;
      filter: blur(70px) saturate(1.35) contrast(1.05);
      opacity: .70;
      transform: scale(1.12);
      pointer-events:none;
      mix-blend-mode: screen;
      transition: opacity .35s ease;
      animation: ambientDrift 10s ease-in-out infinite alternate;
    }
    @keyframes ambientDrift{
      from{ transform: scale(1.12) translate3d(-1.5%, -1%, 0); }
      to{ transform: scale(1.12) translate3d(1.5%, 1%, 0); }
    }

    #ambientBg{
      position:fixed;
      inset:0;
      z-index:-2;
      background:
        radial-gradient(1200px 700px at 50% 18%, rgba(120,150,255,.14), transparent 60%),
        radial-gradient(900px 600px at 18% 72%, rgba(255,120,210,.08), transparent 62%),
        radial-gradient(1100px 700px at 80% 78%, rgba(90,255,220,.06), transparent 66%),
        linear-gradient(180deg, #0b0b16, #05050a);
      transition: filter .35s ease;
    }
    #ambientGlow{
      position:fixed;
      inset:-12vh;
      z-index:-1;
      pointer-events:none;
      background: radial-gradient(circle at 50% 45%, rgba(120,150,255,.35), transparent 58%);
      filter: blur(18px) saturate(1.15);
      opacity:.95;
      transition: background .55s ease, opacity .55s ease;
    }

    /* ===== Page glass ===== */
    .glassPage{
      min-height: 100vh;
      padding: 18px 18px 80px;
      background: rgba(255,255,255,.040);
      backdrop-filter: blur(28px);
      -webkit-backdrop-filter: blur(28px);
    }

/* Desktop často vypadá sklo „křídově bílé“ – stáhneme mléčný spodní rim a shine jen pro hover/pointer zařízení */
@media (hover: hover) and (pointer: fine){
  #wtModes{
    --glassClearA: rgba(255,255,255,.10);
    --glassClearB: rgba(255,255,255,.06);
    --glassMilkA:  rgba(255,255,255,.06);
    --glassMilkB:  rgba(255,255,255,.08);
    --botRim1: rgba(255,255,255,.46);
    --botRim2: rgba(255,255,255,.18);
  }
  #wtMainPill{
    --glassClearA: rgba(255,255,255,.10);
    --glassClearB: rgba(255,255,255,.06);
    --glassMilkA:  rgba(255,255,255,.06);
    --glassMilkB:  rgba(255,255,255,.08);
    --botRim1: rgba(255,255,255,.46);
    --botRim2: rgba(255,255,255,.18);
  }
  #wtModes .glassBase,
  #wtMainPill .glassBase{
    background:
      radial-gradient(120% 120% at 50% 60%, var(--glassMilkA), transparent 62%),
      radial-gradient(120% 120% at 50% 92%, var(--glassMilkB), transparent 58%),
      radial-gradient(120% 120% at 35% 25%, var(--glassClearA), transparent 55%),
      radial-gradient(140% 140% at 65% 70%, var(--glassClearB), transparent 60%),
      rgba(255,255,255,.05);
    box-shadow:
      inset 0 18px 26px rgba(0,0,0,.24),
      inset 0 -22px 30px rgba(255,255,255,.14),
      0 22px 44px rgba(0,0,0,.18);
  }
}

    .topBar{
      position: sticky;
      top: 0;
      z-index: 10;
      padding: calc(env(safe-area-inset-top) + 12px) 0 16px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 14px;
    }
    .rightGroup{ display:flex; gap:12px; align-items:center; margin-left:auto; }

    /* ===== mode buttons (round, like your WT arrows) ===== */
    #wtModes{
      --outer: 190px;
      --innerRatio: .65;
      --glassClearA: rgba(255,255,255,.14);
      --glassClearB: rgba(255,255,255,.08);
      --glassMilkA:  rgba(255,255,255,.10);
      --glassMilkB:  rgba(255,255,255,.12);
      --glassRingThickness: 13px;
      --glassRimBlur: 1.05px;
      --topRim1: rgba(0,0,0,.28);
      --topRim2: rgba(0,0,0,.12);
      --topRimFade: 30%;
      --botRim1: rgba(255,255,255,.74);
      --botRim2: rgba(255,255,255,.30);
      --bleedA: .14;
      --bleedB: .07;
      --pressY: 3px;
      --pressTimeIn: 110ms;
      --pressTimeOut: 190ms;

      --textColor: rgba(255,255,255,.92);
      --textSize: 34px;
      --textScaleX: 1.10;
      --textWidth: 92%;

      --stroke: rgba(0,0,0,.34);
      --depth1: rgba(0,0,0,.30);
      --depth2: rgba(0,0,0,.18);
      --lacquer: rgba(255,255,255,.28);

      --modeScale: .235;
      display:flex;
      gap: 12px;
      align-items:center;
    }

    #wtModes .wtModeBtn{ display:flex; align-items:center; }

    #wtModes .glassBase{
      --w: var(--outer);
      --h: var(--outer);
      --r: 50%;
      --smearInset: 10px;

      --rimTint: 120, 155, 255;
      --bleedX: 76%;
      --bleedY: 84%;

      width: var(--w);
      height: var(--h);
      border-radius: var(--r);
      position: relative;
      display:grid;
      place-items:center;
      isolation:isolate;

      background:
        radial-gradient(120% 120% at 50% 60%, var(--glassMilkA), transparent 62%),
        radial-gradient(120% 120% at 50% 92%, var(--glassMilkB), transparent 58%),
        radial-gradient(120% 120% at 35% 25%, var(--glassClearA), transparent 55%),
        radial-gradient(140% 140% at 65% 70%, var(--glassClearB), transparent 60%),
        rgba(255,255,255,.08);

      box-shadow:
        inset 0 18px 26px rgba(0,0,0,.24),
        inset 0 -22px 30px rgba(255,255,255,.22),
        0 22px 44px rgba(0,0,0,.18);

      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);

      transition: filter var(--pressTimeOut) ease;

      zoom: var(--modeScale);
      transform-origin: center;
    }
    @supports not (zoom: 1){
      #wtModes .glassBase{ zoom:1; transform: scale(var(--modeScale)); }
    }

    #wtModes .glassBase::before{
      content:"";
      position:absolute;
      inset: var(--smearInset);
      border-radius: var(--r);
      pointer-events:none;
      z-index:1;

      background:
        radial-gradient(75% 60% at 18% 22%,
          rgba(255,255,255,.42) 0%,
          rgba(255,255,255,.18) 35%,
          transparent 72%),
        radial-gradient(55% 45% at 28% 32%,
          rgba(255,255,255,.18) 0%,
          transparent 72%);

      filter: blur(1.35px);
      opacity:.95;
    }

    #wtModes .glassBase::after{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius: var(--r);
      pointer-events:none;
      z-index:2;

      background:
        radial-gradient(72% 60% at var(--bleedX) var(--bleedY),
          rgba(var(--rimTint), var(--bleedA)) 0%,
          rgba(var(--rimTint), var(--bleedB)) 28%,
          transparent 68%),

        conic-gradient(from 210deg,
          transparent 0 18%,
          rgba(var(--rimTint), .12) 22%,
          transparent 36%,
          rgba(var(--rimTint), .06) 46%,
          transparent 62%,
          rgba(var(--rimTint), .045) 70%,
          transparent 100%),

        radial-gradient(140% 120% at 50% 120%,
          var(--botRim1) 0%,
          var(--botRim2) 22%,
          transparent 52%),

        radial-gradient(170% 120% at 50% -38%,
          var(--topRim1) 0%,
          var(--topRim2) 14%,
          transparent var(--topRimFade));

      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;

      padding: var(--glassRingThickness);
      filter: blur(var(--glassRimBlur));
      opacity:.95;
    }

    #wtModes .pressGlow{
      position:absolute;
      inset:-22px;
      border-radius: 50%;
      pointer-events:none;
      opacity:0;
      filter: blur(10px);
      transition: opacity var(--pressTimeOut) ease, transform var(--pressTimeOut) ease;
      transform: scale(0.995);
      z-index:0;

      background:
        radial-gradient(80% 80% at 70% 70%,
          rgba(var(--rimTint), .18) 0%,
          rgba(var(--rimTint), .10) 26%,
          transparent 62%),
        radial-gradient(100% 90% at 50% 110%,
          rgba(255,255,255,.20) 0%,
          transparent 55%);
    }

    #wtModes .coreBtn{
      --cw: calc(var(--outer) * var(--innerRatio));
      --ch: calc(var(--outer) * var(--innerRatio));
      --cr: 50%;

      width: var(--cw);
      height: var(--ch);
      border-radius: var(--cr);

      position:relative;
      z-index:3;
      border:0;
      padding:0;
      cursor:pointer;

      outline: none !important;
      -webkit-tap-highlight-color: transparent;
      user-select:none;

      background:
        radial-gradient(120% 120% at 35% 25%, rgba(255,255,255,.16), transparent 55%),
        linear-gradient(180deg, #6f7ed0, #5462bb 55%, #4a57ae);

      box-shadow:
        0 18px 26px rgba(0,0,0,.18),
        inset 0 16px 22px rgba(0,0,0,.13),
        inset 0 -14px 20px rgba(255,255,255,.14);

      transform: translateY(0);
      transition:
        transform var(--pressTimeOut) cubic-bezier(.2,.8,.2,1),
        box-shadow var(--pressTimeOut) ease,
        filter var(--pressTimeOut) ease;

      display:grid;
      place-items:center;
    }

    #wtModes .glassBase:has(.coreBtn:active){ filter: brightness(.985); transition: filter var(--pressTimeIn) ease; }
    #wtModes .glassBase:has(.coreBtn:active) .pressGlow{ opacity:1; transform: scale(1.01); transition: opacity var(--pressTimeIn) ease, transform var(--pressTimeIn) ease; }
    #wtModes .coreBtn:active{
      transform: translateY(var(--pressY));
      transition:
        transform var(--pressTimeIn) cubic-bezier(.2,.8,.2,1),
        box-shadow var(--pressTimeIn) ease,
        filter var(--pressTimeIn) ease;

      box-shadow:
        0 10px 18px rgba(0,0,0,.16),
        inset 0 20px 26px rgba(0,0,0,.18),
        inset 0 -10px 16px rgba(255,255,255,.10);
      filter: brightness(.99) saturate(.98);
    }

    #wtModes .coreText{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;

      width: var(--textWidth);
      margin: 0 auto;

      color: var(--textColor);
      font-weight: 760;
      font-size: var(--textSize);
      letter-spacing: .40px;
      line-height: 1;
      text-transform: lowercase;

      transform: scaleX(var(--textScaleX));
      transform-origin: center;

      text-shadow:
        -0.75px 0      0 var(--stroke),
         0.75px 0      0 var(--stroke),
         0      -0.75px 0 var(--stroke),
         0       0.75px 0 var(--stroke),
        -0.55px -0.55px 0 var(--stroke),
         0.55px -0.55px 0 var(--stroke),
        -0.55px  0.55px 0 var(--stroke),
         0.55px  0.55px 0 var(--stroke),
        0 -0.55px 0 var(--lacquer),
        0  1.25px 1.45px var(--depth1),
        0  3px    8px    var(--depth2);
    }

    #wtModes .wtModeBtn.isActive .glassBase{ filter: saturate(1.05) brightness(1.03); }
    #wtModes .wtModeBtn.isActive .glassBase::after{ opacity: 1; }
    
    .titleMini{
      font-weight: 900;
      letter-spacing: .6px;
      color: rgba(255,255,255,.88);
      text-shadow: 0 14px 36px rgba(0,0,0,.55);
      user-select:none;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* ===== Grid plakátů ===== */
    #eventsGrid{
      max-width: 1180px;
      margin: 0 auto;
      padding-top: 10px;
    }

    /* DATE mode: posters one under another, centered, near phone width */
    #eventsGrid:not(.randomMode){
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 26px;
    }

    /* RANDOM mode: floating puzzle / collage */
    #eventsGrid.randomMode{
      column-gap: 18px;
      column-count: 2;
      max-width: 1200px;
    }
    @media (min-width: 520px){
      #eventsGrid.randomMode{ column-count: 3; }
    }
    @media (min-width: 980px){
      #eventsGrid.randomMode{ column-count: 4; }
    }

    .poster{
      position:relative;
      width: min(92vw, 560px);
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 26px 90px rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      transform: translateZ(0);
      break-inside: avoid;
      -webkit-column-break-inside: avoid;
      will-change: transform;
    }
    #eventsGrid.randomMode .poster{
      width: auto;
      margin: 0 0 18px 0;
      /* overlap a bit */
      margin-top: calc(var(--lift, 0px) * -1);
      transform: translate3d(var(--tx,0px), var(--ty,0px), 0) rotate(var(--rot,0deg));
      z-index: var(--z, 1);
    }
    #eventsGrid:not(.randomMode) .poster{
      transform: none !important;
      margin: 0;
    }

    .poster img{
      width:100%;
      height:auto;
      display:block;
    }

    /* no captions in final view */
    .cap{ display:none !important; }
.posterCard{
      position:relative;
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 26px 90px rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      transform: translateZ(0);
      text-decoration:none;
      color:inherit;
      display:block;
    }
    .posterCard img{
      width:100%;
      height:auto;
      display:block;
    }
    .cap{
      position:absolute;
      left:0; right:0; bottom:0;
      padding: 12px 12px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 10px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,.62));
      color:#fff;
    }
    .capTitle{ font-weight: 900; letter-spacing: .25px; text-transform: lowercase; }
    .capDate{ opacity:.88; font-size: 12px; }

    .err{
      max-width: 980px;
      margin: 18px auto 0;
      padding: 14px 16px;
      border-radius: 14px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.9);
    }

    /* ===== WT pill (Main Page) — engine převzatý z oknoGIT.html ===== */
    #wtMainPill{

    --outer: 190px;
    --innerRatio: .65;
    --pillW: 440px;

    --glassClearA: rgba(255,255,255,.14);
    --glassClearB: rgba(255,255,255,.08);
    --glassMilkA:  rgba(255,255,255,.10);
    --glassMilkB:  rgba(255,255,255,.12);

    --glassRingThickness: 13px;
    --glassRimBlur: 1.05px;

    --topRim1: rgba(0,0,0,.28);
    --topRim2: rgba(0,0,0,.12);
    --topRimFade: 30%;

    --botRim1: rgba(255,255,255,.74);
    --botRim2: rgba(255,255,255,.30);

    --bleedA: .14;
    --bleedB: .07;

    --pressY: 3px;
    --pressTimeIn: 110ms;
    --pressTimeOut: 190ms;

    --textColor: rgba(255,255,255,.92);
    --textSize: 34px;
    --textScaleX: 1.12;
    --textWidth: 90%;

    --stroke: rgba(0,0,0,.34);
    --depth1: rgba(0,0,0,.30);
    --depth2: rgba(0,0,0,.18);
    --lacquer: rgba(255,255,255,.28);

    /* škálování do horního řádku okna */
    --pillScale: .253;
    display:flex;
    align-items:center;
  }

  #wtMainPill *{ box-sizing:border-box; }

  #wtMainPill .glassBase{
    --w: var(--outer);
    --h: var(--outer);
    --r: 50%;
    --smearInset: 10px;

    --rimTint: 120, 155, 255;
    --bleedX: 76%;
    --bleedY: 84%;

    width: var(--w);
    height: var(--h);
    border-radius: var(--r);
    position: relative;
    display:grid;
    place-items:center;
    isolation:isolate;

    background:
      radial-gradient(120% 120% at 50% 60%, var(--glassMilkA), transparent 62%),
      radial-gradient(120% 120% at 50% 92%, var(--glassMilkB), transparent 58%),
      radial-gradient(120% 120% at 35% 25%, var(--glassClearA), transparent 55%),
      radial-gradient(140% 140% at 65% 70%, var(--glassClearB), transparent 60%),
      rgba(255,255,255,.08);

    box-shadow:
      inset 0 18px 26px rgba(0,0,0,.24),
      inset 0 -22px 30px rgba(255,255,255,.22),
      0 22px 44px rgba(0,0,0,.18);

    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);

    transition: filter var(--pressTimeOut) ease;

    /* scale without distorting */
    zoom: var(--pillScale);
    transform-origin: left center;
  }
  @supports not (zoom: 1){
    #wtMainPill .glassBase{
      zoom: 1;
      transform: scale(var(--pillScale));
    }
  }

  #wtMainPill .glassBase::before{
    content:"";
    position:absolute;
    inset: var(--smearInset);
    border-radius: var(--r);
    pointer-events:none;
    z-index:1;

    background:
      radial-gradient(75% 60% at 18% 22%,
        rgba(255,255,255,.42) 0%,
        rgba(255,255,255,.18) 35%,
        transparent 72%),
      radial-gradient(55% 45% at 28% 32%,
        rgba(255,255,255,.18) 0%,
        transparent 72%);

    filter: blur(1.35px);
    opacity:.95;
  }

  #wtMainPill .glassBase::after{
    content:"";
    position:absolute;
    inset:-1px;
    border-radius: var(--r);
    pointer-events:none;
    z-index:2;

    background:
      radial-gradient(72% 60% at var(--bleedX) var(--bleedY),
        rgba(var(--rimTint), var(--bleedA)) 0%,
        rgba(var(--rimTint), var(--bleedB)) 28%,
        transparent 68%),

      conic-gradient(from 210deg,
        transparent 0 18%,
        rgba(var(--rimTint), .12) 22%,
        transparent 36%,
        rgba(var(--rimTint), .06) 46%,
        transparent 62%,
        rgba(var(--rimTint), .045) 70%,
        transparent 100%),

      radial-gradient(140% 120% at 50% 120%,
        var(--botRim1) 0%,
        var(--botRim2) 22%,
        transparent 52%),

      radial-gradient(170% 120% at 50% -38%,
        var(--topRim1) 0%,
        var(--topRim2) 14%,
        transparent var(--topRimFade));

    -webkit-mask:
      linear-gradient(#000 0 0) content-box,
      linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;

    padding: var(--glassRingThickness);
    filter: blur(var(--glassRimBlur));
    opacity:.95;
  }

  #wtMainPill .pressGlow{
    position:absolute;
    inset:-22px;
    border-radius: var(--r);
    pointer-events:none;
    opacity:0;
    filter: blur(10px);
    transition: opacity var(--pressTimeOut) ease, transform var(--pressTimeOut) ease;
    transform: scale(0.995);
    z-index:0;

    background:
      radial-gradient(80% 80% at 70% 70%,
        rgba(var(--rimTint), .18) 0%,
        rgba(var(--rimTint), .10) 26%,
        transparent 62%),
      radial-gradient(100% 90% at 50% 110%,
        rgba(255,255,255,.20) 0%,
        transparent 55%);
  }

  #wtMainPill .coreBtn{
    --cw: calc(var(--outer) * var(--innerRatio));
    --ch: calc(var(--outer) * var(--innerRatio));
    --cr: 50%;

    width: var(--cw);
    height: var(--ch);
    border-radius: var(--cr);

    position:relative;
    z-index:3;
    border:0;
    padding:0;
    cursor:pointer;

    outline: none !important;
    -webkit-tap-highlight-color: transparent;
    user-select:none;

    background:
      radial-gradient(120% 120% at 35% 25%, rgba(255,255,255,.16), transparent 55%),
      linear-gradient(180deg, var(--c1), var(--c2) 55%, var(--c3));

    box-shadow:
      0 18px 26px rgba(0,0,0,.18),
      inset 0 16px 22px rgba(0,0,0,.13),
      inset 0 -14px 20px rgba(255,255,255,.14);

    transform: translateY(0);
    transition:
      transform var(--pressTimeOut) cubic-bezier(.2,.8,.2,1),
      box-shadow var(--pressTimeOut) ease,
      filter var(--pressTimeOut) ease;

    display:grid;
    place-items:center;

    /* make it a link that looks like a button */
    text-decoration:none;
  }

  #wtMainPill .glassBase:has(.coreBtn:active){
    filter: brightness(.985);
    transition: filter var(--pressTimeIn) ease;
  }
  #wtMainPill .glassBase:has(.coreBtn:active) .pressGlow{
    opacity:1;
    transform: scale(1.01);
    transition: opacity var(--pressTimeIn) ease, transform var(--pressTimeIn) ease;
  }
  #wtMainPill .coreBtn:active{
    transform: translateY(var(--pressY));
    transition:
      transform var(--pressTimeIn) cubic-bezier(.2,.8,.2,1),
      box-shadow var(--pressTimeIn) ease,
      filter var(--pressTimeIn) ease;

    box-shadow:
      0 10px 18px rgba(0,0,0,.16),
      inset 0 20px 26px rgba(0,0,0,.18),
      inset 0 -10px 16px rgba(255,255,255,.10);
    filter: brightness(.99) saturate(.98);
  }

  #wtMainPill .pill{
    --w: var(--pillW);
    --h: var(--outer);
    --r: calc(var(--outer)/2);
    --gap: calc(var(--outer) * (1 - var(--innerRatio)) / 2);
  }
  #wtMainPill .pill .coreBtn{
    --ch: calc(var(--outer) * var(--innerRatio));
    --cw: calc(var(--pillW) - (2 * var(--gap)));
    --cr: calc((var(--outer) * var(--innerRatio)) / 2);
  }

  #wtMainPill .v-blue{
    --c1:#6f7ed0; --c2:#5462bb; --c3:#4a57ae;
    --rimTint: 120, 155, 255;
    --bleedX: 74%; --bleedY: 86%;
  }

  #wtMainPill .coreText{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;

    width: var(--textWidth);
    margin: 0 auto;

    color: var(--textColor);
    font-weight: 720;
    font-size: var(--textSize);
    letter-spacing: .55px;
    line-height: 1;
    text-transform: lowercase;

    transform: scaleX(var(--textScaleX));
    transform-origin: center;

    text-shadow:
      -0.75px 0      0 var(--stroke),
       0.75px 0      0 var(--stroke),
       0      -0.75px 0 var(--stroke),
       0       0.75px 0 var(--stroke),
      -0.55px -0.55px 0 var(--stroke),
       0.55px -0.55px 0 var(--stroke),
      -0.55px  0.55px 0 var(--stroke),
       0.55px  0.55px 0 var(--stroke),
      0 -0.55px 0 var(--lacquer),
      0  1.25px 1.45px var(--depth1),
      0  3px    8px    var(--depth2);
  }
#wtModes .coreBtn{
      display:grid;
      place-items:center;
    }


    .wtIcon{
      width: 30px;
      height: 30px;
      display:block;
      color: rgba(18,18,22,.92);
    }
</style>
</head>
<body>
  <div id="ambientPoster" aria-hidden="true"></div>
  <div id="ambientBg"></div>
  <div id="ambientGlow"></div>

  <div class="glassPage">
    <div class="topBar">
      <div id="wtMainPill" aria-label="Main page">
        <div class="glassBase pill v-blue">
          <div class="pressGlow"></div>
          <a class="coreBtn" href="index.html" aria-label="Main page">
            <span class="coreText">main page</span>
          </a>
        </div>
      </div>

      <div class="rightGroup">
        <div id="wtModes" class="modes" aria-label="Řazení plakátů">
          <div class="wtModeBtn isActive" data-mode="date" aria-label="Řazení podle data">
            <div class="glassBase v-blue">
              <div class="pressGlow"></div>
              <button class="coreBtn" type="button" aria-label="Řadit podle data">
                <svg class="wtIcon" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 3v2M17 3v2M4 8h16M6 6h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
              </button>
            </div>
          </div>

          <div class="wtModeBtn" data-mode="random" aria-label="Náhodné rozložení">
            <div class="glassBase v-blue">
              <div class="pressGlow"></div>
              <button class="coreBtn" type="button" aria-label="Náhodné rozložení">
                <svg class="wtIcon" viewBox="0 0 24 24" aria-hidden="true"><path d="M16 3h5v5M4 20l5-5M4 4l7 7M9 9l-5 5M21 16v5h-5M14 14l7 7M15 4l6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
          </div>
        </div>
</div>
    </div>

    <div id="eventsGrid" aria-label="Seznam plakátů"></div>
  </div>


<script>
  const DATA_URL = 'data/events.json';
  let DATA_URL_USED = DATA_URL;

  const grid = document.getElementById('eventsGrid');
  const ambient = document.getElementById('ambientBg');
  const ambientGlow = document.getElementById('ambientGlow');
  const ambientPoster = document.getElementById('ambientPoster');

  const modeButtons = Array.from(document.querySelectorAll('#wtModes .wtModeBtn'));

  function parseDate(d){
    const [y,m,dd] = String(d).split('-').map(Number);
    return new Date(y, (m||1)-1, dd||1, 12, 0, 0);
  }

  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
function setAmbientPoster(src){
    if(!src) return;
    // visible 'under glass' bleed: blurred poster image
    ambientPoster.style.backgroundImage = `url('${src}')`;
  }


  function setAmbientFromRGB(rgb){
  // Zachovej temný základ + přidej "ambient bleed" z plakátu pod mléčné sklo.
  const r = clamp(Math.round(rgb.r), 0, 255);
  const g = clamp(Math.round(rgb.g), 0, 255);
  const b = clamp(Math.round(rgb.b), 0, 255);

  ambient.style.background = `
    radial-gradient(1200px 720px at 50% 18%, rgba(${r},${g},${b},.22), transparent 60%),
    radial-gradient(900px 620px at 18% 72%, rgba(${r},${g},${b},.12), transparent 62%),
    radial-gradient(1100px 720px at 80% 78%, rgba(${r},${g},${b},.10), transparent 66%),
    linear-gradient(180deg, #0b0b16, #05050a)
  `;

  ambientGlow.style.background = `
    radial-gradient(circle at 50% 42%, rgba(${r},${g},${b},.38), transparent 58%)
  `;
}

// --- average color extraction (fast enough for posters) ---
  const colorCache = new Map();
  async function getAverageColor(imgEl){
    const src = imgEl.currentSrc || imgEl.src;
    if(colorCache.has(src)) return colorCache.get(src);

    // If CORS blocks canvas on GitHub pages for some reason, fallback to neutral
    const fallback = { r: 120, g: 155, b: 255 };

    try{
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.decoding = 'async';
      img.src = src;

      await new Promise((res, rej)=>{
        img.onload = ()=>res();
        img.onerror = ()=>rej(new Error('img load failed'));
      });

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d', { willReadFrequently:true });

      const w = 64;
      const h = 64;
      canvas.width = w;
      canvas.height = h;

      ctx.drawImage(img, 0, 0, w, h);
      const data = ctx.getImageData(0,0,w,h).data;

      let r=0,g=0,b=0, n=0;
      for(let i=0;i<data.length;i+=4){
        const a = data[i+3];
        if(a < 24) continue;
        r += data[i];
        g += data[i+1];
        b += data[i+2];
        n++;
      }
      if(!n) return fallback;
      const out = { r: Math.round(r/n), g: Math.round(g/n), b: Math.round(b/n) };
      colorCache.set(src, out);
      return out;
    }catch(e){
      return fallback;
    }
  }

  
  function hash01(str){
    // deterministic 0..1 from string
    let h = 2166136261;
    for(let i=0;i<str.length;i++){
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    // >>>0 to uint32
    return ((h>>>0) % 100000) / 100000;
  }

  function posterHTML(e, randomize){
    const title = e.title || '';
    const img = e.image || '';
    const date = e.date || '';
    const key = img || (title + '|' + date);

    let style = '';
    if(randomize){
      const a = hash01(key + '|a');
      const b = hash01(key + '|b');
      const c = hash01(key + '|c');
      const d = hash01(key + '|d');

      const rot = (a*14 - 7).toFixed(2);
      const tx  = (b*70 - 35).toFixed(1);
      const ty  = (c*70 - 35).toFixed(1);
      const lift = (d*34).toFixed(1);
      const z = Math.floor(d*9)+1;

      style = `style="--rot:${rot}deg; --tx:${tx}px; --ty:${ty}px; --lift:${lift}px; --z:${z};"`;
    }

    return `
      <figure class="poster" data-key="${key}" data-title="${title}" data-date="${date}" ${style}>
        <img loading="lazy" src="${img}" alt="${title}">
      </figure>
    `;
  }


  function updateActiveMode(mode){
    modeButtons.forEach(b=>{
      b.classList.toggle('isActive', b.dataset.mode === mode);
    });
  }

  let allEvents = [];

  async function load(){
    const candidates = [
      DATA_URL,
      '/data/events.json',
      './data/events.json',
      'assets/data/events.json',
      './assets/data/events.json'
    ];

    let lastErr = null;
    for(const url of candidates){
      try{
        const res = await fetch(url, { cache:'no-store' });
        if(!res.ok) { lastErr = new Error(url + ' (status ' + res.status + ')'); continue; }
        allEvents = await res.json();
        // success
        DATA_URL_USED = url;
        break;
      }catch(e){
        lastErr = e;
      }
    }

    if(!Array.isArray(allEvents)){
      throw lastErr || new Error('events.json not found');
    }

    // init mode
    applyMode('date');
  }

  function getPastEvents(){
    const today = new Date();
    today.setHours(0,0,0,0);
    return allEvents
      .filter(e => e?.date && parseDate(e.date) < today && e?.image)
      .sort((a,b)=> parseDate(b.date) - parseDate(a.date));
  }

  
  function applyMode(mode){
    // FLIP: record previous positions
    const prev = new Map();
    Array.from(grid.querySelectorAll('.poster')).forEach(el=>{
      const key = el.dataset.key || '';
      if(!key) return;
      prev.set(key, el.getBoundingClientRect());
    });

    const past = getPastEvents();
    const list = (mode === 'random') ? shuffle(past) : past;

    grid.classList.toggle('randomMode', mode === 'random');
    grid.innerHTML = list.map(e => posterHTML(e, mode === 'random')).join('');
    updateActiveMode(mode);

    // Apply FLIP animation to new layout
    const nextEls = Array.from(grid.querySelectorAll('.poster'));
    nextEls.forEach(el=>{
      const key = el.dataset.key || '';
      const from = prev.get(key);
      const to = el.getBoundingClientRect();

      // If element existed before, animate from previous position
      if(from){
        const dx = from.left - to.left;
        const dy = from.top - to.top;
        // Note: we only animate translation; CSS handles random rotation/tx/ty in random mode.
        el.animate([
          { transform: `translate(${dx}px, ${dy}px)` },
          { transform: 'translate(0px, 0px)' }
        ], {
          duration: 520,
          easing: 'cubic-bezier(.2,.9,.2,1)',
          fill: 'both'
        });
      }else{
        // New: fade in
        el.animate([{ opacity: 0 }, { opacity: 1 }], { duration: 380, easing:'ease-out', fill:'both' });
      }
    });

    // set ambient from first image once it loads
    const imgs = Array.from(grid.querySelectorAll('img'));
    if(imgs[0]){
      if(imgs[0].complete){
        setAmbientPoster(imgs[0].currentSrc || imgs[0].src);
        getAverageColor(imgs[0]).then(setAmbientFromRGB);
      }else{
        imgs[0].addEventListener('load', async ()=>{
          setAmbientPoster(imgs[0].currentSrc || imgs[0].src);
          setAmbientFromRGB(await getAverageColor(imgs[0]));
        }, { once:true });
      }
    }

    // scroll ambient: pick poster closest to center
    const posters = Array.from(grid.querySelectorAll('.poster'));
    let ticking = false;

    async function updateAmbientOnScroll(){
      const center = window.innerHeight / 2;
      let best = null, bestDist = Infinity;

      for(const p of posters){
        const r = p.getBoundingClientRect();
        const pc = r.top + r.height/2;
        const dist = Math.abs(center - pc);
        if(dist < bestDist){
          bestDist = dist;
          best = p;
        }
      }
      if(best){
        const img = best.querySelector('img');
        if(img){
          setAmbientPoster(img.currentSrc || img.src);
          const col = await getAverageColor(img);
          setAmbientFromRGB(col);
        }
      }
      ticking = false;
    }

    window.removeEventListener('scroll', window.__wtScrollHandler || (()=>{}));
    window.__wtScrollHandler = ()=>{
      if(ticking) return;
      ticking = true;
      requestAnimationFrame(updateAmbientOnScroll);
    };
    window.addEventListener('scroll', window.__wtScrollHandler, { passive:true });
    // initial
    window.__wtScrollHandler();
  }


  // button wiring
  modeButtons.forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      e.preventDefault();
      const mode = btn.dataset.mode;
      applyMode(mode);
    });
  });

  load().catch(err=>{
    console.error(err);
    grid.innerHTML = `<div class="err">Nepodařilo se načíst seznam akcí. Zkontroluj cestu: <code>${DATA_URL_USED}</code></div>`;
  });
</script>

</body>
</html>

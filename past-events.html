<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Past Events</title>

  <style>
    html,body{
      margin:0;
      padding:0;
      background:transparent;
      color:#eef0ff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      position:relative;
      overflow-x:hidden;
    }

    #pageBase{
      position:fixed;
      inset:0;
      z-index:0;
      background:#0b0b10;
      pointer-events:none;
    }
    a,button{ -webkit-tap-highlight-color: transparent; }
    a:focus, a:focus-visible, button:focus, button:focus-visible{ outline: none !important; box-shadow:none !important; }


    /* ===== Ambient background (bez videa) ===== */
    #ambientBg{
      position:fixed;
      inset:0;
      z-index:1;
      pointer-events:none;
      --ambR: 145; --ambG: 85; --ambB: 255; /* fallback purple */
      background:
        radial-gradient(1100px 720px at 52% 16%, rgba(var(--ambR),var(--ambG),var(--ambB),.30), transparent 62%),
        radial-gradient(820px 520px at 18% 62%, rgba(80,150,255,.18), transparent 60%),
        radial-gradient(820px 520px at 86% 70%, rgba(255,70,205,.14), transparent 60%),
        linear-gradient(180deg, #0b0b10, #0b0b10);
      transition: filter .35s ease, background .45s ease;
    }

    #ambientPoster{
      position:fixed;
      inset:-14vh;
      z-index:2;
      pointer-events:none;
      background: none;
      background-size: cover;
      background-position: center;
      filter: blur(86px) saturate(1.15);
      opacity:.10;
      transform: scale(1.06);
      mix-blend-mode: screen;
      transition: background-image .55s ease, opacity .55s ease;
    }

    #ambientGlow{
      position:fixed;
      inset:-12vh;
      z-index:3;
      pointer-events:none;
      background: radial-gradient(circle at 50% 45%, rgba(120,150,255,.35), transparent 58%);
      filter: blur(20px) saturate(1.25);
      mix-blend-mode: screen;
      opacity:.98;
      transition: background .55s ease, opacity .55s ease;
    }

    
@keyframes wtAmbientDrift{
  0%{ transform: translate3d(0,0,0) scale(1.02); filter: blur(18px) saturate(1.25); }
  50%{ transform: translate3d(1.5vw,-1.2vh,0) scale(1.04); filter: blur(20px) saturate(1.35); }
  100%{ transform: translate3d(0,0,0) scale(1.02); filter: blur(18px) saturate(1.25); }
}
#ambientPoster{ animation: wtAmbientDrift 8.5s ease-in-out infinite; }
#ambientGlow{ animation: wtAmbientDrift 7.2s ease-in-out infinite reverse; }

/* ===== Page glass ===== */
    .glassPage{
      min-height: 100vh;
      padding: 160px 18px 90px;
      background: rgba(255,255,255,.032); border: 1px solid rgba(255,255,255,.085);
      backdrop-filter: blur(28px);
      -webkit-backdrop-filter: blur(28px);
    }

    .glassPage{
      position:relative;
      z-index:10;
    }
    .glassPage::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      border-radius: 22px;
      /* sandblasted grain */
      background-image:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.06) 0 1px, transparent 2px),
        radial-gradient(circle at 70% 60%, rgba(255,255,255,.05) 0 1px, transparent 2px),
        radial-gradient(circle at 40% 80%, rgba(255,255,255,.04) 0 1px, transparent 2px);
      background-size: 18px 18px, 22px 22px, 26px 26px;
      mix-blend-mode: overlay;
      opacity: .35;
      filter: blur(.2px);
    }

    .glassPage::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:1;
      background:
        radial-gradient(1200px 800px at 50% 10%, rgba(255,255,255,.08), transparent 60%),
        repeating-linear-gradient(0deg, rgba(255,255,255,.018) 0 1px, rgba(0,0,0,0) 1px 3px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.014) 0 1px, rgba(0,0,0,0) 1px 4px);
      mix-blend-mode: overlay;
      opacity:.58;
    }
    /* keep actual content above grain */
    .glassPage > *{ position: relative; z-index: 2; }

/* Desktop často vypadá sklo „křídově bílé“ – stáhneme mléčný spodní rim a shine jen pro hover/pointer zařízení */
@media (hover: hover) and (pointer: fine){
  #wtModes{
    --glassClearA: rgba(255,255,255,.10);
    --glassClearB: rgba(255,255,255,.06);
    --glassMilkA:  rgba(255,255,255,.06);
    --glassMilkB:  rgba(255,255,255,.08);
    --botRim1: rgba(255,255,255,.46);
    --botRim2: rgba(255,255,255,.18);
  }
  #wtMainPill{
    --glassClearA: rgba(255,255,255,.10);
    --glassClearB: rgba(255,255,255,.06);
    --glassMilkA:  rgba(255,255,255,.06);
    --glassMilkB:  rgba(255,255,255,.08);
    --botRim1: rgba(255,255,255,.46);
    --botRim2: rgba(255,255,255,.18);
  }
  #wtModes .glassBase,
  #wtMainPill .glassBase{
    background:
      radial-gradient(120% 120% at 50% 60%, var(--glassMilkA), transparent 62%),
      radial-gradient(120% 120% at 50% 92%, var(--glassMilkB), transparent 58%),
      radial-gradient(120% 120% at 35% 25%, var(--glassClearA), transparent 55%),
      radial-gradient(140% 140% at 65% 70%, var(--glassClearB), transparent 60%),
      rgba(255,255,255,.05);
    box-shadow:
      inset 0 18px 26px rgba(0,0,0,.24),
      inset 0 -22px 30px rgba(255,255,255,.14),
      0 22px 44px rgba(0,0,0,.18);
  }
}

    .topBar{
      position: fixed;
      top: 0;
      z-index: 20;
      left: 0; right: 0;
      width: min(1180px, calc(100vw - 36px));
      margin: 0 auto;
      padding: calc(env(safe-area-inset-top) + 12px) 0 16px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 14px;
    }
    .rightGroup{ display:flex; gap:12px; align-items:center; margin-left:auto; }

    /* ===== mode buttons (round, like your WT arrows) ===== */
    #wtModes{
      --outer: 190px;
      --innerRatio: .65;
      --glassClearA: rgba(255,255,255,.14);
      --glassClearB: rgba(255,255,255,.08);
      --glassMilkA:  rgba(255,255,255,.10);
      --glassMilkB:  rgba(255,255,255,.12);
      --glassRingThickness: 13px;
      --glassRimBlur: 1.05px;
      --topRim1: rgba(0,0,0,.28);
      --topRim2: rgba(0,0,0,.12);
      --topRimFade: 30%;
      --botRim1: rgba(255,255,255,.74);
      --botRim2: rgba(255,255,255,.30);
      --bleedA: .14;
      --bleedB: .07;
      --pressY: 3px;
      --pressTimeIn: 110ms;
      --pressTimeOut: 190ms;

      --textColor: rgba(255,255,255,.92);
      --textSize: 34px;
      --textScaleX: 1.10;
      --textWidth: 92%;

      --stroke: rgba(0,0,0,.34);
      --depth1: rgba(0,0,0,.30);
      --depth2: rgba(0,0,0,.18);
      --lacquer: rgba(255,255,255,.28);

      --modeScale: .235;
      display:flex;
      gap: 12px;
      align-items:center;
    }

    #wtModes .wtModeBtn{ display:flex; align-items:center; }

    #wtModes .glassBase{
      --w: var(--outer);
      --h: var(--outer);
      --r: 50%;
      --smearInset: 10px;

      --rimTint: 120, 155, 255;
      --bleedX: 76%;
      --bleedY: 84%;

      width: var(--w);
      height: var(--h);
      border-radius: var(--r);
      position: relative;
      display:grid;
      place-items:center;
      isolation:isolate;

      background:
        radial-gradient(120% 120% at 50% 60%, var(--glassMilkA), transparent 62%),
        radial-gradient(120% 120% at 50% 92%, var(--glassMilkB), transparent 58%),
        radial-gradient(120% 120% at 35% 25%, var(--glassClearA), transparent 55%),
        radial-gradient(140% 140% at 65% 70%, var(--glassClearB), transparent 60%),
        rgba(255,255,255,.08);

      box-shadow:
        inset 0 18px 26px rgba(0,0,0,.24),
        inset 0 -22px 30px rgba(255,255,255,.22),
        0 22px 44px rgba(0,0,0,.18);

      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);

      transition: filter var(--pressTimeOut) ease;

      zoom: var(--modeScale);
      transform-origin: center;
    }
    @supports not (zoom: 1){
      #wtModes .glassBase{ zoom:1; transform: scale(var(--modeScale)); }
    }

    #wtModes .glassBase::before{
      content:"";
      position:absolute;
      inset: var(--smearInset);
      border-radius: var(--r);
      pointer-events:none;
      z-index:1;

      background:
        radial-gradient(75% 60% at 18% 22%,
          rgba(255,255,255,.42) 0%,
          rgba(255,255,255,.18) 35%,
          transparent 72%),
        radial-gradient(55% 45% at 28% 32%,
          rgba(255,255,255,.18) 0%,
          transparent 72%);

      filter: blur(1.35px);
      opacity:.90;
    }

    #wtModes .glassBase::after{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius: var(--r);
      pointer-events:none;
      z-index:2;

      background:
        radial-gradient(72% 60% at var(--bleedX) var(--bleedY),
          rgba(var(--rimTint), var(--bleedA)) 0%,
          rgba(var(--rimTint), var(--bleedB)) 28%,
          transparent 68%),

        conic-gradient(from 210deg,
          transparent 0 18%,
          rgba(var(--rimTint), .12) 22%,
          transparent 36%,
          rgba(var(--rimTint), .06) 46%,
          transparent 62%,
          rgba(var(--rimTint), .045) 70%,
          transparent 100%),

        radial-gradient(140% 120% at 50% 120%,
          var(--botRim1) 0%,
          var(--botRim2) 22%,
          transparent 52%),

        radial-gradient(170% 120% at 50% -38%,
          var(--topRim1) 0%,
          var(--topRim2) 14%,
          transparent var(--topRimFade));

      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;

      padding: var(--glassRingThickness);
      filter: blur(var(--glassRimBlur));
      opacity:.90;
    }

    #wtModes .pressGlow{
      position:absolute;
      inset:-22px;
      border-radius: 50%;
      pointer-events:none;
      opacity:0;
      filter: blur(10px);
      transition: opacity var(--pressTimeOut) ease, transform var(--pressTimeOut) ease;
      transform: scale(0.995);
      z-index:0;

      background:
        radial-gradient(80% 80% at 70% 70%,
          rgba(var(--rimTint), .18) 0%,
          rgba(var(--rimTint), .10) 26%,
          transparent 62%),
        radial-gradient(100% 90% at 50% 110%,
          rgba(255,255,255,.20) 0%,
          transparent 55%);
    }

    #wtModes .coreBtn{
      --cw: calc(var(--outer) * var(--innerRatio));
      --ch: calc(var(--outer) * var(--innerRatio));
      --cr: 50%;

      width: var(--cw);
      height: var(--ch);
      border-radius: var(--cr);

      position:relative;
      z-index:3;
      border:0;
      padding:0;
      cursor:pointer;

      outline: none !important;
      -webkit-tap-highlight-color: transparent;
      user-select:none;

      background:
        radial-gradient(120% 120% at 35% 25%, rgba(255,255,255,.16), transparent 55%),
        linear-gradient(180deg, #6f7ed0, #5462bb 55%, #4a57ae);

      box-shadow:
        0 18px 26px rgba(0,0,0,.18),
        inset 0 16px 22px rgba(0,0,0,.13),
        inset 0 -14px 20px rgba(255,255,255,.14);

      transform: translateY(0);
      transition:
        transform var(--pressTimeOut) cubic-bezier(.2,.8,.2,1),
        box-shadow var(--pressTimeOut) ease,
        filter var(--pressTimeOut) ease;

      display:grid;
      place-items:center;
    }

    #wtModes .glassBase:has(.coreBtn:active){ filter: brightness(.985); transition: filter var(--pressTimeIn) ease; }
    #wtModes .glassBase:has(.coreBtn:active) .pressGlow{ opacity:1; transform: scale(1.01); transition: opacity var(--pressTimeIn) ease, transform var(--pressTimeIn) ease; }
    #wtModes .coreBtn:active{
      transform: translateY(var(--pressY));
      transition:
        transform var(--pressTimeIn) cubic-bezier(.2,.8,.2,1),
        box-shadow var(--pressTimeIn) ease,
        filter var(--pressTimeIn) ease;

      box-shadow:
        0 10px 18px rgba(0,0,0,.16),
        inset 0 20px 26px rgba(0,0,0,.18),
        inset 0 -10px 16px rgba(255,255,255,.10);
      filter: brightness(.99) saturate(.98);
    }

    #wtModes .coreText{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;

      width: var(--textWidth);
      margin: 0 auto;

      color: var(--textColor);
      font-weight: 760;
      font-size: var(--textSize);
      letter-spacing: .40px;
      line-height: 1;
      text-transform: lowercase;

      transform: scaleX(var(--textScaleX));
      transform-origin: center;

      text-shadow:
        -0.75px 0      0 var(--stroke),
         0.75px 0      0 var(--stroke),
         0      -0.75px 0 var(--stroke),
         0       0.75px 0 var(--stroke),
        -0.55px -0.55px 0 var(--stroke),
         0.55px -0.55px 0 var(--stroke),
        -0.55px  0.55px 0 var(--stroke),
         0.55px  0.55px 0 var(--stroke),
        0 -0.55px 0 var(--lacquer),
        0  1.25px 1.45px var(--depth1),
        0  3px    8px    var(--depth2);
    }

    #wtModes .wtModeBtn.isActive .glassBase{ filter: saturate(1.05) brightness(1.03); }
    #wtModes .wtModeBtn.isActive .glassBase::after{ opacity: 1; }
    
    .titleMini{
      font-weight: 900;
      letter-spacing: .6px;
      color: rgba(255,255,255,.88);
      text-shadow: 0 14px 36px rgba(0,0,0,.55);
      user-select:none;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* ===== Grid plakátů ===== */
    #eventsGrid{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      flex-direction: column;
      align-items:center;
      gap: 26px;
      padding-top: 10px;
    }

    /* Date mode: single column posters */
    .poster{
      transition: transform 520ms cubic-bezier(.2,.8,.2,1);
      width: min(92vw, 560px);
      margin: 0 auto;
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 22px 70px rgba(0,0,0,.42);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      transform: translateZ(0);
    }
    .poster img{
      width:100%;
      height:auto;
      display:block;
    }
    /* No captions in Past Events */
    .cap{ display:none !important; }

    /* Random mode (koláž) – bez CSS columns (žádné „useknutí“ / fragmentace) */
    #eventsGrid.randomMode{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 18px 18px;
      max-width: 1180px;
      margin: 0 auto;
      padding: 0 18px;
      align-items:start;
      justify-items:center;
      overflow: visible;
    }
    #eventsGrid.randomMode .poster{
      width: 100%;
      max-width: 360px;
      margin: 0;
      position: relative; /* z-index funguje */
      transition: transform 520ms cubic-bezier(.2,.8,.2,1);
      transform:
        translate(var(--flipX,0px), var(--flipY,0px))
        translate(var(--tx,0px), var(--ty,0px))
        rotate(var(--rot,0deg))
        scale(var(--scl, 1));
      z-index: var(--z, 1);
      will-change: transform;
    }

    /* Mobile: 2–3 vedle sebe (menší základ), pořád bez fragmentace */
    @media (max-width: 560px){
      #eventsGrid.randomMode{
        grid-template-columns: repeat(auto-fit, minmax(clamp(168px, 44vw, 280px), 1fr));
        gap: 16px 14px;
        padding: 0 12px;
      }
      #eventsGrid.randomMode .poster{
        max-width: none;
        border-radius: 14px;
      }
    }
    @media (max-width: 420px){
      #eventsGrid.randomMode{
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px 10px;
        padding: 0 8px;
      }
    }
    @media (min-width: 720px){
      #eventsGrid.randomMode{
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

.posterCard{
      position:relative;
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 22px 70px rgba(0,0,0,.42);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      transform: translateZ(0);
      text-decoration:none;
      color:inherit;
      display:block;
    }
    .posterCard img{
      width:100%;
      height:auto;
      display:block;
    }
    .cap{
      position:absolute;
      left:0; right:0; bottom:0;
      padding: 12px 12px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 10px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,.62));
      color:#fff;
    }
    .capTitle{ font-weight: 900; letter-spacing: .25px; text-transform: lowercase; }
    .capDate{ opacity:.88; font-size: 12px; }

    .err{
      max-width: 980px;
      margin: 18px auto 0;
      padding: 14px 16px;
      border-radius: 14px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.9);
    }

    /* ===== WT pill (Main Page) — engine převzatý z oknoGIT.html ===== */
    #wtMainPill{

    --outer: 190px;
    --innerRatio: .65;
    --pillW: 440px;

    --glassClearA: rgba(255,255,255,.14);
    --glassClearB: rgba(255,255,255,.08);
    --glassMilkA:  rgba(255,255,255,.10);
    --glassMilkB:  rgba(255,255,255,.12);

    --glassRingThickness: 13px;
    --glassRimBlur: 1.05px;

    --topRim1: rgba(0,0,0,.28);
    --topRim2: rgba(0,0,0,.12);
    --topRimFade: 30%;

    --botRim1: rgba(255,255,255,.74);
    --botRim2: rgba(255,255,255,.30);

    --bleedA: .14;
    --bleedB: .07;

    --pressY: 3px;
    --pressTimeIn: 110ms;
    --pressTimeOut: 190ms;

    --textColor: rgba(255,255,255,.92);
    --textSize: 34px;
    --textScaleX: 1.12;
    --textWidth: 90%;

    --stroke: rgba(0,0,0,.34);
    --depth1: rgba(0,0,0,.30);
    --depth2: rgba(0,0,0,.18);
    --lacquer: rgba(255,255,255,.28);

    /* škálování do horního řádku okna */
    --pillScale: .253;
    display:flex;
    align-items:center;
  }

  #wtMainPill *{ box-sizing:border-box; }

  #wtMainPill .glassBase{
    --w: var(--outer);
    --h: var(--outer);
    --r: 50%;
    --smearInset: 10px;

    --rimTint: 120, 155, 255;
    --bleedX: 76%;
    --bleedY: 84%;

    width: var(--w);
    height: var(--h);
    border-radius: var(--r);
    position: relative;
    display:grid;
    place-items:center;
    isolation:isolate;

    background:
      radial-gradient(120% 120% at 50% 60%, var(--glassMilkA), transparent 62%),
      radial-gradient(120% 120% at 50% 92%, var(--glassMilkB), transparent 58%),
      radial-gradient(120% 120% at 35% 25%, var(--glassClearA), transparent 55%),
      radial-gradient(140% 140% at 65% 70%, var(--glassClearB), transparent 60%),
      rgba(255,255,255,.08);

    box-shadow:
      inset 0 18px 26px rgba(0,0,0,.24),
      inset 0 -22px 30px rgba(255,255,255,.22),
      0 22px 44px rgba(0,0,0,.18);

    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);

    transition: filter var(--pressTimeOut) ease;

    /* scale without distorting */
    zoom: var(--pillScale);
    transform-origin: left center;
  }
  @supports not (zoom: 1){
    #wtMainPill .glassBase{
      zoom: 1;
      transform: scale(var(--pillScale));
    }
  }

  #wtMainPill .glassBase::before{
    content:"";
    position:absolute;
    inset: var(--smearInset);
    border-radius: var(--r);
    pointer-events:none;
    z-index:1;

    background:
      radial-gradient(75% 60% at 18% 22%,
        rgba(255,255,255,.42) 0%,
        rgba(255,255,255,.18) 35%,
        transparent 72%),
      radial-gradient(55% 45% at 28% 32%,
        rgba(255,255,255,.18) 0%,
        transparent 72%);

    filter: blur(1.35px);
    opacity:.90;
  }

  #wtMainPill .glassBase::after{
    content:"";
    position:absolute;
    inset:-1px;
    border-radius: var(--r);
    pointer-events:none;
    z-index:2;

    background:
      radial-gradient(72% 60% at var(--bleedX) var(--bleedY),
        rgba(var(--rimTint), var(--bleedA)) 0%,
        rgba(var(--rimTint), var(--bleedB)) 28%,
        transparent 68%),

      conic-gradient(from 210deg,
        transparent 0 18%,
        rgba(var(--rimTint), .12) 22%,
        transparent 36%,
        rgba(var(--rimTint), .06) 46%,
        transparent 62%,
        rgba(var(--rimTint), .045) 70%,
        transparent 100%),

      radial-gradient(140% 120% at 50% 120%,
        var(--botRim1) 0%,
        var(--botRim2) 22%,
        transparent 52%),

      radial-gradient(170% 120% at 50% -38%,
        var(--topRim1) 0%,
        var(--topRim2) 14%,
        transparent var(--topRimFade));

    -webkit-mask:
      linear-gradient(#000 0 0) content-box,
      linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;

    padding: var(--glassRingThickness);
    filter: blur(var(--glassRimBlur));
    opacity:.90;
  }

  #wtMainPill .pressGlow{
    position:absolute;
    inset:-22px;
    border-radius: var(--r);
    pointer-events:none;
    opacity:0;
    filter: blur(10px);
    transition: opacity var(--pressTimeOut) ease, transform var(--pressTimeOut) ease;
    transform: scale(0.995);
    z-index:0;

    background:
      radial-gradient(80% 80% at 70% 70%,
        rgba(var(--rimTint), .18) 0%,
        rgba(var(--rimTint), .10) 26%,
        transparent 62%),
      radial-gradient(100% 90% at 50% 110%,
        rgba(255,255,255,.20) 0%,
        transparent 55%);
  }

  #wtMainPill .coreBtn{
    --cw: calc(var(--outer) * var(--innerRatio));
    --ch: calc(var(--outer) * var(--innerRatio));
    --cr: 50%;

    width: var(--cw);
    height: var(--ch);
    border-radius: var(--cr);

    position:relative;
    z-index:3;
    border:0;
    padding:0;
    cursor:pointer;

    outline: none !important;
    -webkit-tap-highlight-color: transparent;
    user-select:none;

    background:
      radial-gradient(120% 120% at 35% 25%, rgba(255,255,255,.16), transparent 55%),
      linear-gradient(180deg, var(--c1), var(--c2) 55%, var(--c3));

    box-shadow:
      0 18px 26px rgba(0,0,0,.18),
      inset 0 16px 22px rgba(0,0,0,.13),
      inset 0 -14px 20px rgba(255,255,255,.14);

    transform: translateY(0);
    transition:
      transform var(--pressTimeOut) cubic-bezier(.2,.8,.2,1),
      box-shadow var(--pressTimeOut) ease,
      filter var(--pressTimeOut) ease;

    display:grid;
    place-items:center;

    /* make it a link that looks like a button */
    text-decoration:none;
  }

  #wtMainPill .glassBase:has(.coreBtn:active){
    filter: brightness(.985);
    transition: filter var(--pressTimeIn) ease;
  }
  #wtMainPill .glassBase:has(.coreBtn:active) .pressGlow{
    opacity:1;
    transform: scale(1.01);
    transition: opacity var(--pressTimeIn) ease, transform var(--pressTimeIn) ease;
  }
  #wtMainPill .coreBtn:active{
    transform: translateY(var(--pressY));
    transition:
      transform var(--pressTimeIn) cubic-bezier(.2,.8,.2,1),
      box-shadow var(--pressTimeIn) ease,
      filter var(--pressTimeIn) ease;

    box-shadow:
      0 10px 18px rgba(0,0,0,.16),
      inset 0 20px 26px rgba(0,0,0,.18),
      inset 0 -10px 16px rgba(255,255,255,.10);
    filter: brightness(.99) saturate(.98);
  }

  #wtMainPill .pill{
    --w: var(--pillW);
    --h: var(--outer);
    --r: calc(var(--outer)/2);
    --gap: calc(var(--outer) * (1 - var(--innerRatio)) / 2);
  }
  #wtMainPill .pill .coreBtn{
    --ch: calc(var(--outer) * var(--innerRatio));
    --cw: calc(var(--pillW) - (2 * var(--gap)));
    --cr: calc((var(--outer) * var(--innerRatio)) / 2);
  }

  #wtMainPill .v-blue{
    --c1:#6f7ed0; --c2:#5462bb; --c3:#4a57ae;
    --rimTint: 120, 155, 255;
    --bleedX: 74%; --bleedY: 86%;
  }

  #wtMainPill .coreText{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;

    width: var(--textWidth);
    margin: 0 auto;

    color: var(--textColor);
    font-weight: 720;
    font-size: var(--textSize);
    letter-spacing: .55px;
    line-height: 1;
    text-transform: lowercase;

    transform: scaleX(var(--textScaleX));
    transform-origin: center;

    text-shadow:
      -0.75px 0      0 var(--stroke),
       0.75px 0      0 var(--stroke),
       0      -0.75px 0 var(--stroke),
       0       0.75px 0 var(--stroke),
      -0.55px -0.55px 0 var(--stroke),
       0.55px -0.55px 0 var(--stroke),
      -0.55px  0.55px 0 var(--stroke),
       0.55px  0.55px 0 var(--stroke),
      0 -0.55px 0 var(--lacquer),
      0  1.25px 1.45px var(--depth1),
      0  3px    8px    var(--depth2);
  }
#wtModes .coreBtn{
      display:grid;
      place-items:center;
    }


    .wtIcon{
      width: 30px;
      height: 30px;
      display:block;
      color: rgba(18,18,22,.92);
    }


/* ===== Random (puzzle) na telefonu: 2–3 vedle sebe + víc překryvů ===== */


/* ===== Více viditelný ambient pod pískovaným sklem ===== */
#ambientPoster{ opacity:.88; mix-blend-mode: screen; }
#ambientGlow{ opacity: 1; }
.glassPage{ background: rgba(255,255,255,.026); }

  </style>
</head>
<body>
  <div id="pageBase" aria-hidden="true"></div>
  <div id="ambientBg"></div>
  <div id="ambientPoster"></div>
  <div id="ambientGlow"></div>

  <div class="topBar">
      <div id="wtMainPill" aria-label="Main page">
        <div class="glassBase pill v-blue">
          <div class="pressGlow"></div>
          <a class="coreBtn" href="index.html" aria-label="Main page">
            <span class="coreText">main page</span>
          </a>
        </div>
      </div>

      <div class="rightGroup">
        <div id="wtModes" class="modes" aria-label="Řazení plakátů">
          <div class="wtModeBtn isActive" data-mode="date" aria-label="Řazení podle data">
            <div class="glassBase v-blue">
              <div class="pressGlow"></div>
              <button class="coreBtn" type="button" aria-label="Řadit podle data">
                <svg class="wtIcon" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 3v2M17 3v2M4 8h16M6 6h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
              </button>
            </div>
          </div>

          <div class="wtModeBtn" data-mode="random" aria-label="Náhodné rozložení">
            <div class="glassBase v-blue">
              <div class="pressGlow"></div>
              <button class="coreBtn" type="button" aria-label="Náhodné rozložení">
                <svg class="wtIcon" viewBox="0 0 24 24" aria-hidden="true"><path d="M16 3h5v5M4 20l5-5M4 4l7 7M9 9l-5 5M21 16v5h-5M14 14l7 7M15 4l6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
          </div>
        </div>
</div>
    </div>

    
  <div class="glassPage">
    <div id="eventsGrid" aria-label="Seznam plakátů"></div>
  </div>


<script>
  const DATA_URL = 'data/events.json';

  const grid = document.getElementById('eventsGrid');
  const ambient = document.getElementById('ambientBg');
  const ambientGlow = document.getElementById('ambientGlow');
  const ambientPoster = document.getElementById('ambientPoster');

  const modeButtons = Array.from(document.querySelectorAll('#wtModes .wtModeBtn'));

  // --- helpers
  const clamp = (n,a,b)=> Math.max(a, Math.min(b,n));
  function parseDate(s){
    const [y,m,d] = String(s||'').split('-').map(Number);
    return new Date(y||1970, (m||1)-1, d||1, 12, 0, 0);
  }

  // --- ambient: use averaged color (smoothly), poster image only as very subtle texture
  let ambCurrent = { r:145, g:85, b:255 };
  let ambTarget  = { r:145, g:85, b:255 };
  let ambRAF = 0;

  function applyAmbient(){
    const r = Math.round(ambCurrent.r);
    const g = Math.round(ambCurrent.g);
    const b = Math.round(ambCurrent.b);

    // CSS-var based purple base + poster-derived color.
    ambient.style.setProperty('--ambR', r);
    ambient.style.setProperty('--ambG', g);
    ambient.style.setProperty('--ambB', b);

    ambientGlow.style.background =
      `radial-gradient(circle at 50% 42%, rgba(${r},${g},${b},.38), transparent 58%)`;
  }

  function tickAmbient(){
    // critically damped-ish easing to avoid "skákání"
    ambCurrent.r += (ambTarget.r - ambCurrent.r) * 0.10;
    ambCurrent.g += (ambTarget.g - ambCurrent.g) * 0.10;
    ambCurrent.b += (ambTarget.b - ambCurrent.b) * 0.10;

    applyAmbient();

    const dr = Math.abs(ambTarget.r - ambCurrent.r);
    const dg = Math.abs(ambTarget.g - ambCurrent.g);
    const db = Math.abs(ambTarget.b - ambCurrent.b);
    if (dr + dg + db > 0.8){
      ambRAF = requestAnimationFrame(tickAmbient);
    } else {
      ambRAF = 0;
    }
  }

  function setAmbientTarget(rgb){
    ambTarget = {
      r: clamp(rgb.r, 0, 255),
      g: clamp(rgb.g, 0, 255),
      b: clamp(rgb.b, 0, 255),
    };
    if(!ambRAF) ambRAF = requestAnimationFrame(tickAmbient);
  }

  async function getAverageColor(img){
    const c = document.createElement('canvas');
    const ctx = c.getContext('2d', { willReadFrequently:true });
    const w = 42, h = 42;
    c.width = w; c.height = h;

    ctx.drawImage(img, 0, 0, w, h);
    const data = ctx.getImageData(0,0,w,h).data;

    let r=0,g=0,b=0,count=0;
    for(let i=0;i<data.length;i+=4){
      const a = data[i+3];
      if(a < 24) continue;
      r += data[i];
      g += data[i+1];
      b += data[i+2];
      count++;
    }
    if(!count) return {r:145,g:85,b:255};
    return { r: r/count, g: g/count, b: b/count };
  }

  // very subtle poster texture (optional, not "viditelný plakát")
  function setPosterTexture(img){
    const src = img.currentSrc || img.src;
    ambientPoster.style.backgroundImage = `url('${src}')`;
  }

  // --- render
  let items = [];
  let currentMode = 'date';
  let observer = null;

  function posterEl(e, idx){
    const a = document.createElement(e.link ? 'a' : 'div');
    a.className = 'poster';
    a.dataset.key = String(idx);
    if(e.link) {
      a.href = e.link;
      a.target = '_blank';
      a.rel = 'noopener';
      a.classList.add('posterCard');
    }

    const img = document.createElement('img');
    img.loading = 'lazy';
    img.alt = e.title || '';
    img.src = e.image;

    a.appendChild(img);
    return a;
  }

  function updateActiveMode(mode){
    modeButtons.forEach(btn => {
      const is = btn.dataset.mode === mode;
      btn.classList.toggle('isActive', is);
    });
  }

  function randomizeVars(){
    const posters = Array.from(grid.querySelectorAll('.poster'));
    // stronger "plutí" + overlap
    posters.forEach((el, i) => {
      const tx  = (Math.random()*2 - 1) * 54;     // -54..54
      const ty  = (Math.random()*2 - 1) * 86;     // -86..86  (víc nahoru/dolů)
      const rot = (Math.random()*2 - 1) * 6.2;    // -6.2..6.2 deg
      const scl = 0.94 + Math.random()*0.18;      // 0.94..1.12
      const lift= 0;                              // (nepoužíváme layout lift – jen transform)
      const z   = 1 + Math.round(Math.random()*12); // 1..13 (víc vrstvení)

      el.style.setProperty('--tx', tx.toFixed(1)+'px');
      el.style.setProperty('--ty', ty.toFixed(1)+'px');
      el.style.setProperty('--rot', rot.toFixed(2)+'deg');
      el.style.setProperty('--scl', scl.toFixed(3));
      el.style.setProperty('--lift', lift+'px');
      el.style.setProperty('--z', z);
    });
  }

  function clearRandomVars(){
    const posters = Array.from(grid.querySelectorAll('.poster'));
    posters.forEach(el => {
      el.style.removeProperty('--tx');
      el.style.removeProperty('--ty');
      el.style.removeProperty('--rot');
      el.style.removeProperty('--scl');
      el.style.removeProperty('--lift');
      el.style.removeProperty('--z');
    });
  }

  function flipAnimate(before){
    const posters = Array.from(grid.querySelectorAll('.poster'));
    posters.forEach(el => {
      const key = el.dataset.key;
      const b = before.get(key);
      if(!b) return;
      const a = el.getBoundingClientRect();
      const dx = b.left - a.left;
      const dy = b.top - a.top;
      if(Math.abs(dx)+Math.abs(dy) < 0.5) return;

      el.style.setProperty('--flipX', dx.toFixed(1)+'px');
      el.style.setProperty('--flipY', dy.toFixed(1)+'px');
      el.style.willChange = 'transform';

      // next frame -> animate to 0
      requestAnimationFrame(() => {
        el.style.setProperty('--flipX', '0px');
        el.style.setProperty('--flipY', '0px');
        // cleanup will-change after transition
        setTimeout(() => { el.style.willChange = ''; }, 650);
      });
    });
  }

  function setMode(mode){
    // allow "Random" to reshuffle on repeated clicks
    if(mode === currentMode){
      if(mode === 'random'){
        const posters = Array.from(grid.querySelectorAll('.poster'));
        const before = new Map();
        posters.forEach(el => before.set(el.dataset.key, el.getBoundingClientRect()));
        randomizeVars();
        requestAnimationFrame(() => flipAnimate(before));
      }
      return;
    }

    const posters = Array.from(grid.querySelectorAll('.poster'));
    const before = new Map();
    posters.forEach(el => before.set(el.dataset.key, el.getBoundingClientRect()));

    currentMode = mode;
    grid.classList.toggle('randomMode', mode === 'random');
    updateActiveMode(mode);

    if(mode === 'random') randomizeVars();
    else clearRandomVars();

    // allow layout to settle then FLIP
    requestAnimationFrame(() => {
      flipAnimate(before);
    });
  }

  function setupAmbientObserver(){
    if(observer) observer.disconnect();

    const imgs = Array.from(grid.querySelectorAll('img'));
    if(!imgs.length) return;

    // initial
    imgs[0].addEventListener('load', async () => {
      setPosterTexture(imgs[0]);
      setAmbientTarget(await getAverageColor(imgs[0]));
    }, { once:true });

    // track the image closest to center via intersection ratio
    observer = new IntersectionObserver(async (entries) => {
      const best = entries
        .filter(e => e.isIntersecting)
        .sort((a,b)=> b.intersectionRatio - a.intersectionRatio)[0];
      if(!best) return;

      const img = best.target;
      if(!img.complete) return;

      // subtle texture + smooth color
      setPosterTexture(img);
      const rgb = await getAverageColor(img);
      setAmbientTarget(rgb);
    }, { threshold: [0.35, 0.55, 0.72] });

    imgs.forEach(img => {
      if(img.complete) observer.observe(img);
      else img.addEventListener('load', () => observer.observe(img), { once:true });
    });
  }

  async function init(){
    // fetch json
    const res = await fetch(DATA_URL, { cache:'no-store' });
    if(!res.ok) throw new Error('Nejde načíst '+DATA_URL+' (status '+res.status+')');
    const all = await res.json();

    const today = new Date(); today.setHours(0,0,0,0);
    items = (all||[])
      .filter(e => e && e.date && e.image && parseDate(e.date) < today)
      .sort((a,b)=> parseDate(b.date) - parseDate(a.date));

    if(!items.length){
      grid.innerHTML = '<div class="err">V JSONu nejsou žádné minulé akce.</div>';
      return;
    }

    // render once (stable DOM so FLIP works)
    grid.innerHTML = '';
    items.forEach((e, idx) => grid.appendChild(posterEl(e, idx)));

    // hook buttons
    modeButtons.forEach(btn => {
      btn.addEventListener('click', () => setMode(btn.dataset.mode));
      const b = btn.querySelector('button');
      if(b) b.addEventListener('click', () => setMode(btn.dataset.mode));
    });

    // default mode = date
    updateActiveMode('date');
    clearRandomVars();

    setupAmbientObserver();
    applyAmbient();
  }

  init().catch(err => {
    grid.innerHTML = '<div class="err">'+String(err.message || err)+'</div>';
  });
</script>

</body>
</html>

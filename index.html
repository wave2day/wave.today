<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WT Background – Module</title>

<style>
/* ===== BASE (module-friendly: žádné centrování body) ===== */
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#0a0808;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  overflow:hidden;
}

/* ===== BACKGROUND SYSTEM ===== */
:root{
  --glass-blur: 11px;
  --glass-milk: 0.045;
  --grain-op: 0.14;

  --proj-opacity: 0.48;
  --proj-blur: 16px;
  --proj-bright: 1.55;
  --proj-sat: 2.55;
  --proj-contrast: 1.28;

  /* LED panel proportions */
  --panelH: 132px;
  --panelPadY: 18px;
  --panelPadX: 44px;
  --gap: 20px;

  --glassClearA: rgba(255,255,255,.14);
  --glassClearB: rgba(255,255,255,.08);
  --glassMilkA:  rgba(255,255,255,.10);
  --glassMilkB:  rgba(255,255,255,.12);

  --glassRingThickness: 13px;
  --glassRimBlur: 1.05px;

  --topRim1: rgba(0,0,0,.24);
  --topRim2: rgba(0,0,0,.09);
  --topRimFade: 30%;

  --botRim1: rgba(255,255,255,.74);
  --botRim2: rgba(255,255,255,.30);

  --led: 86px;
  --ledRing: 12px;

  --haloBoost: 1.65;
  --coreBoost: 1.25;

  --panelInterferenceBase: .18;
  --panelInterferenceStep: .28;
}

#video-layer{
  position:fixed;
  inset:0;
  z-index:0;
  overflow:hidden;
}

#video-layer video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}

#myVideo{
  filter: blur(2px);
  transform: scale(1.03);
}

/* ===== GLASS 1 – sand ===== */
.sandGlass{
  position:absolute;
  inset:0;
  z-index:2;
  pointer-events:none;
  background: rgba(255,255,255,var(--glass-milk));
  backdrop-filter: blur(var(--glass-blur));
}
.sandGlass::before{
  content:"";
  position:absolute;
  inset:0;
  opacity: var(--grain-op);
  mix-blend-mode: overlay;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.25) 0 1px, transparent 2px);
}

/* ===== PROJECTION (Ambient V2) ===== */
#bloomVideo{
  z-index:3;
  pointer-events:none;
  filter:
    blur(var(--proj-blur))
    brightness(var(--proj-bright))
    contrast(var(--proj-contrast))
    saturate(var(--proj-sat));
  opacity: var(--proj-opacity);
  mix-blend-mode: color-dodge;
  transform: scale(1.06);
  animation: drift 60s ease-in-out infinite alternate;
}
@keyframes drift{
  0%{ transform: scale(1.05) translate3d(0.5%, -0.3%, 0); }
  100%{ transform: scale(1.075) translate3d(-0.5%, 0.3%, 0); }
}

/* ===== BOUNCE GLOW – odraz mezi dvěma skly ===== */
#bounceVideo{
  z-index:4;
  pointer-events:none;
  filter:
    url(#wtHotExtract)
    blur(10px)
    brightness(1.85)
    contrast(1.55)
    saturate(3.2);
  opacity: 0.42;
  mix-blend-mode: screen;
  transform: translate3d(1.0%, -0.7%, 0) scale(1.08);
  transform-origin: 50% 50%;
  will-change: transform, opacity, filter;
  animation: wtGapDrift 64s ease-in-out infinite alternate;
}
@keyframes wtGapDrift{
  0%{ transform: translate3d(1.0%, -0.7%, 0) scale(1.075); opacity: 0.36; }
  100%{ transform: translate3d(-1.0%, 0.7%, 0) scale(1.095); opacity: 0.46; }
}

/* ===== GLASS 2 – prism ===== */
.prismGlass{
  position:absolute;
  inset:0;
  z-index:5;
  pointer-events:none;
  background: rgba(255,255,255,0.010);
  mix-blend-mode: overlay;
  opacity: 0.92;
  filter: url(#wtPrismStrong);
}

/* ===== LED PANEL (beze změny vzhledu) ===== */
*{box-sizing:border-box}

.panel{
  height: var(--panelH);
  width: fit-content;
  padding: var(--panelPadY) var(--panelPadX);
  border-radius: calc(var(--panelH) / 2);
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  isolation:isolate;

  background:
    radial-gradient(120% 120% at 50% 60%, var(--glassMilkA), transparent 62%),
    radial-gradient(120% 120% at 50% 92%, var(--glassMilkB), transparent 58%),
    radial-gradient(120% 120% at 35% 25%, var(--glassClearA), transparent 55%),
    radial-gradient(140% 140% at 65% 70%, var(--glassClearB), transparent 60%),
    rgba(255,255,255,.08);

  box-shadow:
    inset 0 18px 26px rgba(0,0,0,.22),
    inset 0 -22px 30px rgba(255,255,255,.22),
    0 22px 54px rgba(0,0,0,.28);

  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}
.panel::before{
  content:"";
  position:absolute;
  inset: 12px;
  border-radius: inherit;
  pointer-events:none;
  z-index: 1;
  background:
    radial-gradient(75% 60% at 18% 22%,
      rgba(255,255,255,.40) 0%,
      rgba(255,255,255,.16) 35%,
      transparent 72%),
    radial-gradient(55% 45% at 28% 32%,
      rgba(255,255,255,.16) 0%,
      transparent 72%);
  filter: blur(1.35px);
  opacity:.95;
}
.panel::after{
  content:"";
  position:absolute;
  inset:-1px;
  border-radius: inherit;
  pointer-events:none;
  z-index: 6;
  background:
    radial-gradient(70% 70% at 92% 18%,
      rgba(255,255,255,.18) 0%,
      rgba(255,255,255,.08) 34%,
      transparent 62%),
    radial-gradient(85% 75% at 88% 20%,
      rgba(0,0,0,.14) 0%,
      transparent 58%),

    radial-gradient(140% 120% at 50% 120%,
      var(--botRim1) 0%,
      var(--botRim2) 22%,
      transparent 52%),
    radial-gradient(170% 120% at 50% -38%,
      var(--topRim1) 0%,
      var(--topRim2) 14%,
      transparent var(--topRimFade));

  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;

  padding: var(--glassRingThickness);
  filter: blur(var(--glassRimBlur));
  opacity:.95;
}

.panelLight{
  position:absolute;
  inset: 14px;
  border-radius: inherit;
  pointer-events:none;
  z-index: 2;
  mix-blend-mode: screen;
  filter: blur(16px);
  opacity: var(--panelInterferenceBase);
  transition: opacity .18s ease;

  background:
    radial-gradient(150px 110px at 22% 56%, rgba(var(--L1), .46), transparent 70%),
    radial-gradient(150px 110px at 50% 56%, rgba(var(--L2), .46), transparent 70%),
    radial-gradient(150px 110px at 78% 56%, rgba(var(--L3), .46), transparent 70%),
    linear-gradient(90deg,
      rgba(var(--L1), .08),
      rgba(var(--L2), .10),
      rgba(var(--L3), .08));
}

.ledRow{
  display:flex;
  gap: var(--gap);
  z-index: 7;
  position:relative;
}

.led{
  --rimTint: 0, 255, 255;
  --c1:#e9ffff; --c2:#72f6ff; --c3:#00a7b8;
  --on:0;

  width: var(--led);
  height: var(--led);
  border-radius:50%;
  position:relative;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  isolation:isolate;
}

.led .halo{
  position:absolute;
  inset:-72px;
  border-radius:50%;
  pointer-events:none;
  z-index: 0;

  background:
    radial-gradient(62% 62% at 50% 58%,
      rgba(var(--rimTint), calc((.10 + .95*var(--on)) * var(--haloBoost))) 0%,
      rgba(255,255,255, calc(.08 * var(--on))) 18%,
      rgba(var(--rimTint), 0) 78%);

  filter: blur(calc(16px + 30px*var(--on)));
  opacity: calc(.06 + .94*var(--on));
  mix-blend-mode: screen;
  transition: opacity .18s ease, filter .18s ease;
}

.led .seat{
  position:absolute;
  inset:-4px;
  border-radius:50%;
  z-index: 1;

  background:
    radial-gradient(closest-side at 50% 52%,
      rgba(255,255,255,.34) 0%,
      rgba(255,255,255,.16) 60%,
      rgba(255,255,255,0) 72%),

    radial-gradient(110% 90% at 48% 66%,
      rgba(var(--rimTint), calc(.035 + .18*var(--on))) 0%,
      rgba(var(--rimTint), calc(.015 + .10*var(--on))) 42%,
      transparent 76%),

    radial-gradient(100% 80% at 60% 72%,
      rgba(var(--rimTint), calc(.020 + .14*var(--on))) 0%,
      rgba(var(--rimTint), 0) 60%),

    radial-gradient(110% 110% at 50% 60%,
      rgba(255,255,255,.14) 0%,
      rgba(255,255,255,.06) 34%,
      rgba(0,0,0,.12) 58%,
      rgba(0,0,0,.28) 76%,
      rgba(0,0,0,0) 88%),

    radial-gradient(92% 92% at 50% 92%,
      rgba(0,0,0,.20),
      rgba(0,0,0,0) 72%);

  box-shadow:
    inset 0 12px 14px rgba(255,255,255,.22),
    inset 0 -20px 24px rgba(0,0,0,.32),
    0 8px 12px rgba(0,0,0,.26);

  opacity:.96;
}
.led .seat::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  pointer-events:none;

  background:
    radial-gradient(85% 75% at 50% 60%,
      rgba(0,0,0,.18),
      rgba(0,0,0,0) 70%);

  opacity: calc(.55 * (1 - var(--on)));
  filter: blur(1.1px);
}

.led .fuga{
  position:absolute;
  left: calc(var(--ledRing) - 1px);
  top:  calc(var(--ledRing) - 1px);
  width: calc(var(--led) - (var(--ledRing) - 1px)*2);
  height: calc(var(--led) - (var(--ledRing) - 1px)*2);
  border-radius:50%;
  z-index: 2;
  pointer-events:none;

  background:
    radial-gradient(closest-side at 50% 55%,
      rgba(0,0,0,.24) 64%,
      rgba(0,0,0,.12) 74%,
      rgba(0,0,0,0) 86%);

  filter: blur(.35px);
  opacity:.9;
}

.led .rim{
  position:absolute;
  inset:0;
  border-radius:50%;
  z-index: 3;
  pointer-events:none;

  background:
    radial-gradient(72% 60% at 76% 84%,
      rgba(var(--rimTint), calc(.05 * (0.20 + 0.90*var(--on)))) 0%,
      rgba(var(--rimTint), calc(.03 * (0.20 + 0.90*var(--on)))) 30%,
      transparent 70%),

    radial-gradient(140% 120% at 50% 120%,
      rgba(255,255,255,.70) 0%,
      rgba(255,255,255,.24) 22%,
      transparent 52%),

    radial-gradient(170% 120% at 50% -38%,
      rgba(0,0,0,.24) 0%,
      rgba(0,0,0,.09) 14%,
      transparent 30%),

    radial-gradient(110% 110% at 50% 60%,
      rgba(var(--rimTint), calc(.30 * (0.12 + 0.88*var(--on)))) 0%,
      rgba(var(--rimTint), calc(.16 * (0.12 + 0.88*var(--on)))) 44%,
      rgba(var(--rimTint), calc(.07 * (0.12 + 0.88*var(--on)))) 64%,
      transparent 74%);

  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;

  padding: var(--ledRing);
  filter: blur(1px);
  opacity:.98;
}

.led .lens{
  position:absolute;
  left: var(--ledRing);
  top:  var(--ledRing);
  width: calc(var(--led) - var(--ledRing)*2);
  height: calc(var(--led) - var(--ledRing)*2);
  border-radius:50%;
  z-index: 4;
  overflow:hidden;

  background:
    radial-gradient(18px 18px at 28% 22%,
      rgba(255,255,255,.68), rgba(255,255,255,0) 65%),

    linear-gradient(180deg,
      rgba(255,255,255,.58) 0%,
      rgba(255,255,255,.14) 26%,
      rgba(255,255,255,.06) 48%,
      rgba(0,0,0,.10) 100%),

    linear-gradient(180deg, var(--c1), var(--c2) 55%, var(--c3));

  border: 0;
  box-shadow:
    inset 0 -18px 22px rgba(0,0,0,.34),
    inset 0  10px 14px rgba(255,255,255,.12),
    0 10px 16px rgba(0,0,0,.18);

  transition: filter .18s ease, transform .18s ease;
}

.led .lens::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  pointer-events:none;
  background:
    radial-gradient(closest-side at 50% 58%,
      rgba(255,255,255,.16) 66%,
      rgba(255,255,255,.06) 74%,
      rgba(0,0,0,.10) 82%,
      rgba(0,0,0,0) 90%);
  filter: blur(1.0px);
  opacity:.85;
}

.led .shine1,.led .shine2{
  position:absolute;
  left: 12%;
  right:12%;
  border-radius:999px;
  transform: rotate(-6deg);
  pointer-events:none;
  mix-blend-mode: screen;
}
.led .shine1{
  top: 10%;
  height: 46%;
  background: radial-gradient(76% 90% at 50% 0%,
    rgba(255,255,255,.88),
    rgba(255,255,255,0) 74%);
  opacity:.56;
  filter: blur(1.05px);
}
.led .shine2{
  top: 27%;
  left: 18%;
  right:18%;
  height: 28%;
  background: radial-gradient(82% 110% at 50% 0%,
    rgba(255,255,255,.78),
    rgba(255,255,255,0) 76%);
  opacity:.46;
  filter: blur(1.15px);
}

.led .innerGlow{
  position:absolute;
  inset:-14px;
  border-radius:50%;
  pointer-events:none;
  z-index: 5;

  background:
    radial-gradient(42% 38% at 52% 60%,
      rgba(255,255,255, calc((.12 + .86*var(--on)) * var(--coreBoost))) 0%,
      rgba(255,255,255,0) 62%),
    radial-gradient(58% 56% at 50% 66%,
      rgba(var(--rimTint), calc(.10 + .98*var(--on))) 0%,
      rgba(var(--rimTint), 0) 70%);

  opacity: calc(.10 + .90*var(--on));
  filter: blur(calc(2px + 8px*var(--on)));
  mix-blend-mode: screen;
  transition: opacity .18s ease, filter .18s ease;
}

.led[data-on="1"]{ --on:1; }
.led[data-on="1"] .lens{
  filter: saturate(1.28) brightness(1.14);
  transform: translateY(-1px);
}
.led[data-on="0"]{ --on:0; }

.y{ --rimTint: 255, 235,  70; --c1:#fffbe6; --c2:#fff06a; --c3:#c7a800; }
.m{ --rimTint: 255,  60, 220; --c1:#ffe9fd; --c2:#ff62e9; --c3:#b0008f; }
.c{ --rimTint:  40, 210, 255; --c1:#ecfdff; --c2:#7eefff; --c3:#00a8c7; }

#ledWrapper{
  position: fixed;
  top: 14px;
  right: 14px;
  z-index: 9999;
  transform: scale(0.45);
  transform-origin: top right;
}
</style>
</head>

<body>

<!-- LED PANEL (vpravo) -->
<div id="ledWrapper">
  <div class="panel" id="panel">
    <div class="panelLight" id="panelLight"></div>
    <div class="ledRow">
      <div class="led y" data-on="0" aria-label="Yellow">
        <div class="halo"></div><div class="seat"></div><div class="fuga"></div><div class="rim"></div>
        <div class="lens"><div class="innerGlow"></div><div class="shine1"></div><div class="shine2"></div></div>
      </div>
      <div class="led m" data-on="0" aria-label="Magenta">
        <div class="halo"></div><div class="seat"></div><div class="fuga"></div><div class="rim"></div>
        <div class="lens"><div class="innerGlow"></div><div class="shine1"></div><div class="shine2"></div></div>
      </div>
      <div class="led c" data-on="0" aria-label="Cyan">
        <div class="halo"></div><div class="seat"></div><div class="fuga"></div><div class="rim"></div>
        <div class="lens"><div class="innerGlow"></div><div class="shine1"></div><div class="shine2"></div></div>
      </div>
    </div>
  </div>
</div>

<!-- BACKGROUND LAYERS -->
<div id="video-layer">

  <!-- WT_BG: strong prism + hot color extract -->
  <svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <filter id="wtHotExtract" x="-20%" y="-20%" width="140%" height="140%" color-interpolation-filters="sRGB">
        <feColorMatrix type="matrix"
          values="1.35 -0.15 -0.15 0 0
                  -0.15 1.35 -0.15 0 0
                  -0.15 -0.15 1.35 0 0
                  0     0     0    1 0" result="boost"/>
        <feComponentTransfer in="boost" result="th">
          <feFuncR type="gamma" amplitude="1" exponent="1.65" offset="-0.06"/>
          <feFuncG type="gamma" amplitude="1" exponent="1.65" offset="-0.06"/>
          <feFuncB type="gamma" amplitude="1" exponent="1.65" offset="-0.06"/>
        </feComponentTransfer>
        <feColorMatrix in="th" type="matrix"
          values="1.10 0.05 -0.05 0 0
                  -0.05 1.05 0.05 0 0
                  0.05 -0.10 1.20 0 0
                  0    0    0    1 0"/>
        <feGaussianBlur stdDeviation="0.15"/>
      </filter>

      <filter id="wtPrismStrong" x="-25%" y="-25%" width="150%" height="150%" color-interpolation-filters="sRGB">
        <feTurbulence type="fractalNoise" baseFrequency="0.02 0.035" numOctaves="2" seed="5" result="n">
          <animate attributeName="baseFrequency" dur="80s"
            values="0.018 0.032;0.022 0.038;0.018 0.032" repeatCount="indefinite"/>
        </feTurbulence>
        <feDisplacementMap in="SourceGraphic" in2="n" scale="22"
          xChannelSelector="R" yChannelSelector="G" result="d">
          <animate attributeName="scale" dur="60s" values="16;26;20;22" repeatCount="indefinite"/>
        </feDisplacementMap>
        <feColorMatrix in="d" type="matrix"
          values="1.04 0    0    0 0
                  0    1.00 0    0 0
                  0    0    0.96 0 0
                  0    0    0    1 0"/>
        <feGaussianBlur stdDeviation="0.22"/>
      </filter>
    </defs>
  </svg>

  <!-- BASE VIDEO -->
  <video id="myVideo" autoplay muted loop playsinline preload="auto">
    <source src="assets/video/wave.mp4" type="video/mp4">
  </video>

  <div class="sandGlass" id="glass1"></div>

  <!-- AMBIENT (start hidden) -->
  <video id="bloomVideo" autoplay muted loop playsinline preload="auto" style="visibility:hidden;opacity:0">
    <source src="assets/video/wave.mp4" type="video/mp4">
  </video>

  <!-- BOUNCE (start hidden) -->
  <video id="bounceVideo" autoplay muted loop playsinline preload="auto" aria-hidden="true" style="visibility:hidden;opacity:0">
    <source src="assets/video/wave.mp4" type="video/mp4">
  </video>

  <div class="prismGlass" id="glass2"></div>
</div>

<script>
/* ===== VIDEO SYNC (odlehčené) ===== */
const base = document.getElementById("myVideo");
const bloom = document.getElementById("bloomVideo");
const bounce = document.getElementById("bounceVideo");

function syncOnce(){
  if(base.readyState < 2) return;

  if(bloom && bloom.style.visibility !== "hidden" && bloom.readyState >= 2){
    const d = base.currentTime - bloom.currentTime;
    if(Math.abs(d) > 0.12) bloom.currentTime = base.currentTime;
  }

  if(bounce && bounce.style.visibility !== "hidden" && bounce.readyState >= 2){
    const d2 = base.currentTime - bounce.currentTime;
    if(Math.abs(d2) > 0.45) bounce.currentTime = base.currentTime;
  }
}
setInterval(syncOnce, 250);
</script>

<script>
/* ===== LED PANEL (original logika) ===== */
const leds = [...document.querySelectorAll('.led')];
const panel = document.getElementById('panel');
const panelLight = document.getElementById('panelLight');

function tint(el){
  const v = getComputedStyle(el).getPropertyValue('--rimTint').trim();
  return v || "255,255,255";
}
function rootVar(name){
  return parseFloat(getComputedStyle(document.documentElement).getPropertyValue(name)) || 0;
}
function updatePanelLight(){
  const t = leds.map(tint);
  panel.style.setProperty('--L1', t[0]);
  panel.style.setProperty('--L2', t[1]);
  panel.style.setProperty('--L3', t[2]);

  const k = leds.reduce((n,l)=> n + (l.dataset.on==="1"), 0); // 0..3
  const baseO = rootVar('--panelInterferenceBase');
  const step = rootVar('--panelInterferenceStep');
  panelLight.style.opacity = (baseO + step * k).toFixed(2);
}
leds.forEach(l=>{
  l.addEventListener('click', ()=>{
    l.dataset.on = (l.dataset.on === '1') ? '0' : '1';
    updatePanelLight();
  });
});
updatePanelLight();
</script>

<script>
/* ===== LED -> BACKGROUND (stejné chování + stabilnější přepínání) ===== */
(function(){
  const sand  = document.querySelector('.sandGlass');
  const prism = document.querySelector('.prismGlass');

  const leds = document.querySelectorAll('#ledWrapper .led');
  if(!leds.length) return;

  function setVisible(el, on){
    if(el) el.style.display = on ? "block" : "none";
  }

  function setVideoLayer(v, on){
    if(!v) return;

    // Stabilnější než display none/block (menší šance na "bliknutí" u mix-blend/filter)
    v.style.visibility = on ? "visible" : "hidden";
    v.style.opacity = on ? "" : "0";

    if(on){
      // srovnat čas jen když je vrstva opravdu mimo (hlavně kvůli bounce)
      if(base.readyState >= 2 && v.readyState >= 2){
        const diff = Math.abs(base.currentTime - v.currentTime);
        if(diff > 0.45) v.currentTime = base.currentTime;
      }
      v.play().catch(()=>{});
    }else{
      v.pause();
    }
  }

  function apply(){
    const sandOn    = leds[0]?.dataset.on === "1";
    const prismOn   = leds[1]?.dataset.on === "1";
    const ambientOn = leds[2]?.dataset.on === "1";

    setVisible(sand, sandOn);
    setVisible(prism, prismOn);

    setVideoLayer(bounce, prismOn);
    setVideoLayer(bloom, ambientOn);
  }

  leds.forEach(l=>{
    l.addEventListener("click", ()=>setTimeout(apply,0));
  });

  apply();
})();
</script>

</body>
</html>
